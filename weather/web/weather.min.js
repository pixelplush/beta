let e="Stream Weather",a={},t={},n="",o=1920,s=1080,r=.5;function i(e){return Math.floor(Math.random()*Math.floor(e))}window.setupGame=function(i,l,c){e=i,a=l,t=c,n=a.path||"",t.clouds=void 0===t.clouds||null===t.clouds?!t.overlay:"true"===t.clouds,r=void 0===t.volume||null===t.volume?0:parseInt(t.volume)/100,o=Math.min(window.innerWidth,1920),s=Math.min(window.innerHeight,1080)},window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!async function(){try{const e=(await fetch(`${n}/assets/shamelist.txt`).then((e=>e.text()))).split(",").map((e=>e.trim().toLowerCase()));t.channel&&e&&e.includes(t.channel.toLowerCase())&&(console.log("This channel has been blocked for violating the PixelPlush Terms of Service."),!1)}catch(e){console.log(e)}if(Unicorn.Create("unicorn-display",{width:o,height:s,background:0,init:R,update:A,channel:t.channel,username:t.oauth?t.channel:void 0,password:t.oauth.replace("oauth:",""),onCommand:u,onChat:p,screenWalls:!1,gravity:{x:0,y:0}}),ComfyJS.onCheer=g,ComfyJS.onConnected=async(e,a,n)=>{if(n){let e=await m();0!==e&&(l=e.session,setInterval((()=>{m()}),6e4));let a=await ComfyJS.GetChannelRewards(c,!0),n=Object.keys(h);for(let e=0;e<n.length;e++){let o=n[e];if(a.some((e=>e.title===o))){if(!t[d[e]]){let e=a.find((e=>e.title===o));e&&await ComfyJS.DeleteChannelReward(c,e.id)}}else t[d[e]]&&await ComfyJS.CreateChannelReward(c,{title:o,prompt:h[o].desc,cost:t[d[e]],is_enabled:!0,background_color:h[o].color,is_user_input_required:!1,is_max_per_stream_enabled:!1,max_per_stream:0,is_max_per_user_per_stream_enabled:!1,max_per_user_per_stream:0,is_global_cooldown_enabled:!0,global_cooldown_seconds:h[o].cooldown,should_redemptions_skip_request_queue:!0})}}},ComfyJS.onReward=(e,a,t,n,o)=>{h[a]&&h[a].callback()},t.oauth){let e=await async function(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:`OAuth ${e}`}}).then((e=>e.json())).catch((e=>({error:e})))}(t.oauth.replace("oauth:",""));c=e.client_id,["user:read:email","chat:read","chat:edit","channel:manage:redemptions","channel:read:redemptions"].every((a=>e.scopes.includes(a)))||console.log("Need more permissions"),e.expires_in<1800&&console.log("Token expires soon. Need to generate new link")}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(e,a)}();var l="";let c="";const d=["rain","heavyrain","lightning","rainbow","sunshine","snow","blizzard","blossoms"],h={"Make It Rain!":{desc:"Bring the rains down from Africa!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{w(5)}},"HEAVY RAIN!":{desc:"Lots and strong rains",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{$(5)}},"Lightning BZZT!":{desc:"Flash of lightning!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{b()}},"Rainbow!!!":{desc:"Colors colors everywhere!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{v()}},"Make It Shine!!":{desc:"Let there be light!",color:"#00E5CB",cost:1,cooldown:30,callback:()=>{C()}},"Let It Snow!!!":{desc:"Wintry Fun!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{x(5)}},"HEAVY SNOW!!!":{desc:"It's a blizzard out here!",color:"#00E5CB",cost:1,cooldown:3,callback:()=>{S(5)}},"Flower Power!":{desc:"Beautiful Cherry Blossoms!",color:"#00E5CB",cost:1,cooldown:1,callback:()=>{B(5)}}};async function m(){return fetch("https://api.pixelplush.dev/v1/analytics/heartbeat",{method:"POST",body:JSON.stringify({session:l,game:"weather",theme:e,channel:t.channel,players:[t.channel],count:1})}).then((e=>e.json()))}let f=0;async function u(e,a,t,n,o){if(!document.hidden){if((n.broadcaster||n.mod)&&"resetweather"===a){let e=await ComfyJS.GetChannelRewards(c,!0),a=Object.keys(h);for(let t=0;t<a.length;t++){let n=a[t],o=e.find((e=>e.title===n));o&&await ComfyJS.DeleteChannelReward(c,o.id)}location.reload()}if((n.broadcaster||n.mod)&&"deleteweather"===a){let e=await ComfyJS.GetChannelRewards(c,!0),a=Object.keys(h);for(let t=0;t<a.length;t++){let n=a[t],o=e.find((e=>e.title===n));o&&await ComfyJS.DeleteChannelReward(c,o.id)}}(n.broadcaster||n.mod||n.vip)&&"rain"===a&&w(parseInt(t||5)),(n.broadcaster||n.mod||n.vip)&&"heavyrain"===a&&$(parseInt(t||5)),(n.broadcaster||n.mod||n.vip)&&"lightning"===a&&b(),(n.broadcaster||n.mod||n.vip)&&"rainbow"===a&&v(),(n.broadcaster||n.mod||n.vip)&&"sunrays"===a&&C(),(n.broadcaster||n.mod||n.vip)&&"snoww"===a&&x(5),(n.broadcaster||n.mod||n.vip)&&"heavysnow"===a&&S(5),(n.broadcaster||n.mod||n.vip)&&"blossoms"===a&&B(5),(n.broadcaster||n.mod||n.vip)&&"leaves"===a&&function(e){for(let a=0;a<e;a++)for(let e=0;e<50;e++)setTimeout((()=>{I({x:100,y:100},-100-i(1920))}),i(1e3)+1e3*a)}(5)}}function p(e,a,t,n,o){document.hidden}function g(e,a,t,n,o){document.hidden}let y={},_={};function w(e){for(let a=0;a<e;a++)for(let e=0;e<100;e++)setTimeout((()=>{U("raindrop",i(1920))}),i(1e3)+1e3*a)}function b(){U("lightning",0);let e=i(3e3);setTimeout((()=>{Unicorn.PlaySound(`thunder${i(2)+1}`,{volume:1e3*r/(e+1e3)})}),e)}function $(e){for(let a=0;a<e;a++)for(let e=0;e<200;e++)setTimeout((()=>{U(`heavy_rain_${i(11)+1}`,i(3840)-960)}),i(1e3)+1e3*a)}function v(){U("rainbow",0)}function C(){U("sunrays",0),setTimeout((()=>{U("sunrays",0)}),.25*_.sunrays*y.sunrays.length*1e3)}function U(e,a){f++;let t="particle_"+f,n=Unicorn.AddObject(t,{type:"rectangle",scale:{x:3,y:3},animations:{anim:{framerate:_[e],frames:y[e].slice(),loop:!1}},isStatic:!0,x:a,y:0,z:100});"rainbow"!==e&&"sunrays"!==e&&(n.animations.anim.alpha=.25+.5*Math.random()),n.animations.anim.anchor.set(0),setTimeout((()=>{Unicorn.RemoveObject(t)}),.25*_[e]*y[e].length*1e3)}let k=[];function L(e,a=0){let t=i(10),n="snow_"+ ++f,o=Unicorn.AddBacklay(n,`snowflake${i(7)+1}`,i(3840)+a,-100,{scale:{x:2,y:2}});o.velocity=e||{x:0,y:0},o.name=n,o.progress=0,o.offset=t,k.push(o)}function x(e){for(let a=0;a<e;a++)for(let e=0;e<30;e++)setTimeout((()=>{L()}),i(1e3)+1e3*a);f++;let a=`snow_${f}`;Unicorn.AddParticles(a,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",angle:Math.PI/2,startColor:"#ffffff",endColor:"#ffffff",intensity:2,minSpeed:.05,maxSpeed:.2,decay:15},0,-200),setTimeout((()=>{Unicorn.RemoveParticles(a)}),1e3*e)}function S(e){for(let a=0;a<e;a++)for(let e=0;e<300;e++)setTimeout((()=>{L({x:500,y:500},-960)}),i(1e3)+1e3*a);f++;let a=`snow_${f}`;Unicorn.AddParticles(a,{blendMode:PIXI.BLEND_MODES.DEFAULT,shape:"line",length:3840,angle:Math.PI/4,startColor:"#ffffff",endColor:"#ffffff",intensity:100,minSpeed:.5,maxSpeed:2,decay:15},-1920,-200),setTimeout((()=>{Unicorn.RemoveParticles(a)}),1e3*e)}let E=[];function M(e,a=0){let t=i(10),n="blossom_"+ ++f,o=Unicorn.AddBacklay(n,`blossom${i(12)+1}`,i(3840)+a,-100,{scale:{x:2,y:2}});o.velocity=e||{x:0,y:0},o.name=n,o.progress=0,o.offset=t,E.push(o)}function B(e){for(let a=0;a<e;a++)for(let e=0;e<500;e++)setTimeout((()=>{M({x:100,y:100},-960)}),i(1e3)+1e3*a)}let T=[];function I(e,a=0){let t=i(10),n="leaf_"+ ++f,o=Unicorn.AddBacklay(n,`leaf${i(14)+1}`,a,i(2160)-1080,{scale:{x:2,y:2}});o.velocity=e||{x:0,y:0},o.name=n,o.progress=0,o.offset=t,T.push(o)}function R(){PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;for(let e=1;e<=11;e++){y[`heavy_rain_${e}`]=[],_[`heavy_rain_${e}`]=16/60;for(let a=0;a<12;a++)Unicorn.Load(`heavy_rain_${e}_${a}`,`${n}/assets/stream-weather/heavy_rain/heavy_rain_${e}/heavy_rain_${e}_${a+1}.png`),y[`heavy_rain_${e}`].push(`heavy_rain_${e}_${a}`)}y.lightning=[],_.lightning=16/60;for(let e=0;e<4;e++)Unicorn.Load(`lightning_${e}`,`${n}/assets/stream-weather/lightning/lightning${e+1}.png`),y.lightning.push(`lightning_${e}`);y.raindrop=[],_.raindrop=16/60;for(let e=0;e<10;e++)Unicorn.Load(`raindrop_${e}`,`${n}/assets/stream-weather/raindrop/raindrop${e+1}.png`),y.raindrop.push(`raindrop_${e}`);y.rainbow=[],_.rainbow=16/60;for(let e=0;e<26;e++)Unicorn.Load(`rainbow_${e}`,`${n}/assets/stream-weather/rainbow/rainbow${e}.png`),y.rainbow.push(`rainbow_${e}`);y.sunrays=[],_.sunrays=16/60;for(let e=0;e<40;e++)Unicorn.Load(`sunrays_${e}`,`${n}/assets/stream-weather/sunrays/sunrays${e}.png`),y.sunrays.push(`sunrays_${e}`);for(let e=0;e<7;e++)Unicorn.Load(`snowflake${e+1}`,`${n}/assets/game-parachute/christmas_theme/snowflake_${e+1}.png`);for(let e=0;e<12;e++)Unicorn.Load(`blossom${e+1}`,`${n}/assets/game-parachute/spring_theme/petal${e+1}.png`);Unicorn.Load("leaf1",`${n}/assets/game-parachute/autumn_theme/leaf1.png`),Unicorn.Load("leaf2",`${n}/assets/game-parachute/autumn_theme/leaf2.png`),Unicorn.Load("leaf3",`${n}/assets/game-parachute/autumn_theme/leaf3.png`),Unicorn.Load("leaf4",`${n}/assets/game-parachute/autumn_theme/leaf4.png`),Unicorn.Load("leaf5",`${n}/assets/game-parachute/autumn_theme/leaf5.png`),Unicorn.Load("leaf6",`${n}/assets/game-parachute/autumn_theme/leaf6.png`),Unicorn.Load("leaf7",`${n}/assets/game-parachute/autumn_theme/leaf_gold.png`),Unicorn.Load("leaf8",`${n}/assets/game-parachute/autumn_theme/oak_gold.png`),Unicorn.Load("leaf9",`${n}/assets/game-parachute/autumn_theme/oak1.png`),Unicorn.Load("leaf10",`${n}/assets/game-parachute/autumn_theme/oak2.png`),Unicorn.Load("leaf11",`${n}/assets/game-parachute/autumn_theme/oak3.png`),Unicorn.Load("leaf12",`${n}/assets/game-parachute/autumn_theme/oak4.png`),Unicorn.Load("leaf13",`${n}/assets/game-parachute/autumn_theme/oak5.png`),Unicorn.Load("leaf14",`${n}/assets/game-parachute/autumn_theme/oak6.png`);for(let e=0;e<2;e++)Unicorn.Load(`thunder${e+1}`,`web/thunder${e+1}.mp3`)}function A(e,a){const t=a/1e3;for(let e=0;e<T.length;e++){let a=T[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(T[e].name),T.splice(e--,1)):(T[e].x=2480*Math.sin(a)-100,T[e].y+=t/10*1080+T[e].offset/10+Math.sin(20*a+T[e].offset),T[e].angle=10*Math.cos(20*a)+60*T[e].offset)}for(let e=0;e<k.length;e++){let a=k[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(k[e].name),k.splice(e--,1)):(k[e].x+=k[e].velocity.x*t,k[e].y+=k[e].velocity.y*t+(t/10*1180+k[e].offset/10)+Math.sin(20*a+k[e].offset),k[e].angle=10*Math.cos(20*a)+60*k[e].offset)}for(let e=0;e<E.length;e++){let a=E[e].progress+=t/10;a>=1?(Unicorn.RemoveBacklay(E[e].name),E.splice(e--,1)):(E[e].x+=E[e].velocity.x*t,E[e].y+=E[e].velocity.y*t+(t/10*1180+E[e].offset/10)+Math.sin(20*a+E[e].offset),E[e].angle=10*Math.cos(20*a)+60*E[e].offset)}}